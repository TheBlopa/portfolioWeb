!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ImageKit=t()}(this,(function(){"use strict";function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?r(Object(o),!0).forEach((function(r){t(e,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var o={message:"Missing urlEndpoint during SDK initialization",help:""},a={message:"Invalid transformationPosition parameter",help:""},i={message:"privateKey should not be passed on the client side",help:""},s={message:"Missing file parameter for upload",help:""},p={message:"Missing fileName parameter for upload",help:""},u={message:"Missing authentication endpoint for upload",help:""},l={message:"Missing public key for upload",help:""},c={message:"The authenticationEndpoint you provided timed out in 60 seconds",help:""},f={message:"Request to authenticationEndpoint failed due to network error",help:""},d={message:"Request to ImageKit upload endpoint failed due to network error",help:""},y={message:"Invalid uploadOptions parameter",help:""};function g(e,t,r){"function"==typeof r&&(e?r(t,null):r(null,t))}var h=function(e,t){var r=new XMLHttpRequest;r.timeout=6e4,r.open("GET",e.authenticationEndpoint),r.ontimeout=function(e){g(!0,c,t)},r.onerror=function(){g(!0,f,t)},r.onload=function(){if(200===r.status)try{var e=JSON.parse(r.responseText);g(!1,{signature:e.signature,expire:e.expire,token:e.token},t)}catch(e){g(!0,e,t)}else try{g(!0,JSON.parse(r.responseText),t)}catch(e){g(!0,e,t)}},r.send()},v=function(e,t){var r=new XMLHttpRequest;r.open("POST","https://upload.imagekit.io/api/v1/files/upload"),r.onerror=function(){g(!0,d,t)},r.onload=function(){if(200===r.status){var e=JSON.parse(r.responseText);t(null,e)}else if(200!==r.status)try{t(JSON.parse(r.responseText),null)}catch(e){t(e,null)}},r.send(e)},m=function(e,t,r){if(e)if(e.file)if(e.fileName)if(t.authenticationEndpoint)if(t.publicKey){e.tags&&Array.isArray(e.tags)&&(e.tags=String(e.tags));var o,a=new FormData;for(o in e){var i=e[o];void 0!==i&&("string"==typeof i||"boolean"==typeof i?a.append(o,String(i)):Array.isArray(i)?a.append(o,JSON.stringify(i)):a.append(o,i))}a.append("publicKey",t.publicKey),function(e,t,r){h(t,(function(t,n){if(t)return g(!0,t,r);e.append("signature",(null==n?void 0:n.signature)||""),e.append("expire",String((null==n?void 0:n.expire)||0)),e.append("token",(null==n?void 0:n.token)||""),v(e,(function(e,t){return e?g(!0,e,r):g(!1,t,r)}))}))}(a,n(n({},t),{},{authenticationEndpoint:t.authenticationEndpoint}),r)}else g(!0,l,r);else g(!0,u,r);else g(!0,p,r);else g(!0,s,r);else g(!0,y,r)},b={width:"w",height:"h",aspectRatio:"ar",quality:"q",crop:"c",cropMode:"cm",focus:"fo",x:"x",y:"y",format:"f",radius:"r",background:"bg",border:"b",rotation:"rt",rotate:"rt",blur:"bl",named:"n",overlayImage:"oi",overlayImageAspectRatio:"oiar",overlayImageBackground:"oibg",overlayImageBorder:"oib",overlayImageDPR:"oidpr",overlayImageQuality:"oiq",overlayImageCropping:"oic",overlayImageTrim:"oit",overlayX:"ox",overlayY:"oy",overlayFocus:"ofo",overlayHeight:"oh",overlayWidth:"ow",overlayText:"ot",overlayTextFontSize:"ots",overlayTextFontFamily:"otf",overlayTextColor:"otc",overlayTextTransparency:"oa",overlayAlpha:"oa",overlayTextTypography:"ott",overlayBackground:"obg",overlayTextEncoded:"ote",overlayTextWidth:"otw",overlayTextBackground:"otbg",overlayTextPadding:"otp",overlayTextInnerAlignment:"otia",overlayRadius:"or",progressive:"pr",lossless:"lo",trim:"t",metadata:"md",colorProfile:"cp",defaultImage:"di",dpr:"dpr",effectSharpen:"e-sharpen",effectUSM:"e-usm",effectContrast:"e-contrast",effectGray:"e-grayscale",original:"orig"},w=["path","query"],O=function(){return"path"},x=function(e){return"query"===e.transformationPosition},P=function(e){return void 0!==e.transformationPosition&&-1!=w.indexOf(e.transformationPosition)},T=function(e){return e&&(b[e]||b[e.toLowerCase()])||""},k=function(){return":"},j=function(){return","},E=function(){return"-"};function S(e){return"string"==typeof e&&"/"==e[e.length-1]&&(e=e.substring(0,e.length-1)),e}function I(e,t){var r=t||"/",n=new RegExp(r+"{1,}","g");return e.join(r).replace(n,r)}var R=function(e){if(!e.path&&!e.src)return"";var t,r,n;try{e.path?(n=new URL(e.urlEndpoint).pathname,t=new URL(I([e.urlEndpoint.replace(n,""),e.path]))):(t=new URL(e.src),r=!0)}catch(e){return console.error(e),""}for(var o in e.sdkVersion&&""!=e.sdkVersion.trim()&&t.searchParams.append("ik-sdk-version",e.sdkVersion.trim()),e.queryParameters)t.searchParams.append(o,String(e.queryParameters[o]));var a=function(e){if(!Array.isArray(e))return"";for(var t=[],r=0,n=e.length;r<n;r++){var o=[];for(var a in e[r]){var i=T(a);if(i||(i=a),"-"===e[r][a])o.push(i);else if("raw"===a)o.push(e[r][a]);else{var s=e[r][a];"oi"!==i&&"di"!==i||(s=(s=S(("string"==typeof(p=s||"")&&"/"==p[0]&&(p=p.slice(1)),p))).replace(/\//g,"@@")),o.push([i,s].join(E()))}}t.push(o.join(j()))}var p;return t.join(k())}(e.transformation);return a&&a.length&&(x(e)||r?t.searchParams.append("tr",a):t.pathname=I(["tr"+k()+a,t.pathname])),t.pathname=I(n?[n,t.pathname]:[t.pathname]),t.href};return function(){function r(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),t(this,"options",{sdkVersion:"javascript-".concat("1.4.3"),publicKey:"",urlEndpoint:"",transformationPosition:O()}),this.options=n(n({},this.options),e||{}),!this.options.urlEndpoint)throw o;if(function(e){return void 0!==e.privateKey}(this.options))throw i;if(!P(this.options))throw a}var s,p,u;return s=r,(p=[{key:"url",value:function(e){return t=e,r=this.options,R(n(n({},r),t));var t,r}},{key:"upload",value:function(e,t,r){var o=n(n({},this.options),r);return m(e,o,t)}}])&&e(s.prototype,p),u&&e(s,u),r}()}));
